<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="GLSL Guide # Using custom GLSL functions # Hydra is built using GLSL (a language for generating a program, or shader, that runs directly on the graphics card using WebGl). Each javascript function in hydra corresponds directly to a snippet of shader code. Hydra has a unique way of adding custom source and transform functions which we will explain here.
setFunction # The Hydra API includes a function called setFunction which receives a specific type of JavaScript object.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Custom GLSL" />
<meta property="og:description" content="GLSL Guide # Using custom GLSL functions # Hydra is built using GLSL (a language for generating a program, or shader, that runs directly on the graphics card using WebGl). Each javascript function in hydra corresponds directly to a snippet of shader code. Hydra has a unique way of adding custom source and transform functions which we will explain here.
setFunction # The Hydra API includes a function called setFunction which receives a specific type of JavaScript object." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hydra.ojack.xyz/docs/docs/learning/extending-hydra/glsl/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2023-11-20T16:19:06+01:00" />
<title>Custom GLSL | hydra video synth</title>
<link rel="manifest" href="/docs/manifest.json">
<link rel="icon" href="/docs/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/docs/book.min.9bac9dc478cf52ca962a4f35e004c2cdc70a5461e7451956af25f951f9749ded.css" integrity="sha256-m6ydxHjPUsqWKk814ATCzccKVGHnRRlWryX5Ufl0ne0=" crossorigin="anonymous">
  <script defer src="/docs/flexsearch.min.js"></script>
  <script defer src="/docs/en.search.min.d64c28be836096dab2a26192d88fdda410763b072a7bc0826cda62819a3fb424.js" integrity="sha256-1kwovoNgltqyomGS2I/dpBB2Owcqe8CCbNpigZo/tCQ=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  <link
rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.2/codemirror.min.css"
integrity="sha512-MWdvo/Qqcf4pY1ecQUB1uBn0qLp19U/qJ1Rpp2BDZeuBA7YsFEwkvqR/+aG4BroPiAYDunKJ6X8R/Pmdt3p7oA=="
crossorigin="anonymous"
/>
<link
rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.2/addon/hint/show-hint.min.css"
crossorigin="anonymous"
/>
<link
rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.2/theme/paraiso-dark.min.css"
crossorigin="anonymous"
/>
<script src="https://unpkg.com/torus-dom/dist/index.min.js"></script>
<script
src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.2/codemirror.min.js"
crossorigin="anonymous"
></script>
<script
src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.2/mode/javascript/javascript.min.js"
crossorigin="anonymous"
></script>
<script
src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.2/addon/hint/javascript-hint.min.js"
crossorigin="anonymous"
></script>
<script
src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.2/addon/hint/show-hint.min.js"
crossorigin="anonymous"
></script>
<script
src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.2/addon/selection/mark-selection.min.js"
crossorigin="anonymous"
></script>
<script
src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.59.2/addon/comment/comment.min.js"
crossorigin="anonymous"
></script>
<script src="https://unpkg.com/hydra-synth"></script>
<script src="https://hydra.ojack.xyz/docs/js/hydra-torus-editor.js"></script>
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/docs/"><span>hydra video synth</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>



  



  
    
  
    
  



<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex justify-between">
      <a role="button" class="flex align-center">
        <img src="/docs/svg/translate.svg" class="book-icon" alt="Languages" />
        English
      </a>
    </label>

    <ul>
      
      <li>
        <a href="https://hydra.ojack.xyz/docs/ja/">
          日本語
        </a>
      </li>
      
      <li>
        <a href="https://hydra.ojack.xyz/docs/pt/">
          Portuguese | Português
        </a>
      </li>
      
    </ul>
  </li>
</ul>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/quick-start/" class="">Quick start</a>
  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-7cd66bd2d565ae5bb3c71a81f3ddbfa3" class="toggle" checked />
    <label for="section-7cd66bd2d565ae5bb3c71a81f3ddbfa3" class="flex justify-between">
      <a href="/docs/docs/learning/" class="">learning</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/getting-started/" class="">Getting started</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/web-editor/" class="">Using the web editor</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/video-synth-basics/" class="">Video Synth Basics</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/video-synth-basics/src/" class="">Sources</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/video-synth-basics/coord/" class="">Geometry</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/video-synth-basics/color/" class="">Color</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/video-synth-basics/external-sources/" class="">External sources: webcam, video, canvas</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/video-synth-basics/combine/" class="">Blend</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/video-synth-basics/combinecoord/" class="">Modulate</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/video-synth-basics/settings/" class="">Synth Settings</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/sequencing-and-interactivity/" class="">Sequencing &amp; interactivity</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/sequencing-and-interactivity/arrays/" class="">Arrays</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/sequencing-and-interactivity/audio/" class="">Audio</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/sequencing-and-interactivity/midi/" class="">Midi</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/sequencing-and-interactivity/mouse/" class="">Mouse</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Extending Hydra</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-14148bd41cd0b3003e4e88b693e6efb2" class="toggle"  />
    <label for="section-14148bd41cd0b3003e4e88b693e6efb2" class="flex justify-between">
      <a href="/docs/docs/learning/extending-hydra/contributing/" class="">Developing and contributing</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b494ecce649985cd11b51836e5d7e9e1" class="toggle"  />
    <label for="section-b494ecce649985cd11b51836e5d7e9e1" class="flex justify-between">
      <a href="/docs/docs/learning/extending-hydra/contributing/server/" class="">developing backend server</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3624bfb3c585323e1150e68f68ae751f" class="toggle"  />
    <label for="section-3624bfb3c585323e1150e68f68ae751f" class="flex justify-between">
      <a href="/docs/docs/learning/extending-hydra/contributing/editor/" class="">developing editor</a>
    </label>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-fbb2c3034da361fe243cc053f44f1c5c" class="toggle"  />
    <label for="section-fbb2c3034da361fe243cc053f44f1c5c" class="flex justify-between">
      <a href="/docs/docs/learning/extending-hydra/contributing/synth/" class="">developing hydra-synth</a>
    </label>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/extending-hydra/hydra-in-a-webpage/" class="">Hydra in a Webpage</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/extending-hydra/glsl/" class="active">Custom GLSL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/extending-hydra/extending-hydra/" class="">Using hydra with other javascript libraries</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-98f737d6280aa80f0960850113126c26" class="toggle"  />
    <label for="section-98f737d6280aa80f0960850113126c26" class="flex justify-between">
      <a href="/docs/docs/learning/guides/" class="">Guides</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/guides/textures/" class="">Hydra Book: Textures</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/guides/how-to/" class="">How to</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/guides/how-to/record-hydra-output/" class="">Record hydra&#39;s output</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/guides/how-to/use-hydra-without-showing-code/" class="">Use hydra without showing the code</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
    
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/guides/frames-and-timing/" class="">Frames and Timing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/guides/hydra-garden/" class="">Hydra Garden</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/guides/automatic-patches/" class="">Iteration: automatically generate patches</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/learning/guides/javascript/" class="">javascript for hydra users</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/reference/" class="">reference</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docs/community/" class="">community</a>
  

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/docs/posts/"  >
        blog
      </a>
  </li>
  
  <li>
    <a href="https://opencollective.com/hydra-synth"  target="_blank" rel="noopener">
        contribute
      </a>
  </li>
  
  <li>
    <a href="https://hydra.ojack.xyz/grants"  target="_blank" rel="noopener">
        grants
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/docs/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Custom GLSL</strong>

  <label for="toc-control">
    
    <img src="/docs/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#using-custom-glsl-functions">Using custom GLSL functions</a>
      <ul>
        <li><a href="#setfunction">setFunction</a></li>
        <li><a href="#types-of-glsl-functions-and-their-arguments">Types of GLSL functions and their arguments</a></li>
        <li><a href="#built-in-functions-you-can-use">Built in functions you can use</a></li>
        <li><a href="#examples">Examples</a></li>
      </ul>
    </li>
    <li><a href="#glsl-injection">GLSL Injection</a></li>
    <li><a href="#extensions">Extensions</a>
      <ul>
        <li><a href="#extra-shaders">Extra shaders</a></li>
        <li><a href="#extra-functionality">Extra Functionality</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="glsl-guide">
  GLSL Guide
  <a class="anchor" href="#glsl-guide">#</a>
</h1>
<hr>
<h2 id="using-custom-glsl-functions">
  Using custom GLSL functions
  <a class="anchor" href="#using-custom-glsl-functions">#</a>
</h2>
<p>Hydra is built using GLSL (a language for generating a program, or shader, that runs directly on the graphics card using WebGl). Each javascript function in hydra corresponds directly to a snippet of shader code. Hydra has a unique way of adding custom source and transform functions which we will explain here.</p>
<h3 id="setfunction">
  setFunction
  <a class="anchor" href="#setfunction">#</a>
</h3>
<p>The Hydra API includes a function called <code>setFunction</code> which receives a specific type of JavaScript object. This object will have the properties <code>name</code>, <code>type</code>, <code>inputs</code> and <code>glsl</code>.</p>
<ul>
<li><code>name</code> is a String with the name for the function</li>
<li><code>type</code> is one of the available types of functions (&lsquo;src&rsquo;, &lsquo;color&rsquo;, &lsquo;coord&rsquo;, &lsquo;combine&rsquo;, &lsquo;combineCoord&rsquo;)</li>
<li><code>inputs</code> is an Array of objects each with it&rsquo;s own <code>name</code>, <code>type</code> and <code>default</code> properties. They represent the arguments of the GLSL function.</li>
<li><code>glsl</code> is a String with the glsl code.</li>
</ul>
<h4 id="example">
  Example
  <a class="anchor" href="#example">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">setFunction</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;myOsc&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;src&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">inputs</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;freq&#39;</span>, <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;float&#39;</span>, <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">20</span> }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">glsl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        return vec4(sin((_st.x+time)*freq*vec3(0.1)),1.0);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    `</span>
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><h3 id="types-of-glsl-functions-and-their-arguments">
  Types of GLSL functions and their arguments
  <a class="anchor" href="#types-of-glsl-functions-and-their-arguments">#</a>
</h3>
<h4 id="src">
  src
  <a class="anchor" href="#src">#</a>
</h4>
<p>A function with a specified type of <code>src</code> is one that generates visuals by its own. Just like <code>osc</code> or <code>noise</code>. They all have a <code>vec2</code> argument called <code>_st</code> for the coordinate. And you can add any custom inputs as shown above. You must return a <code>vec4</code>.</p>
<h4 id="color">
  color
  <a class="anchor" href="#color">#</a>
</h4>
<p>A <code>color</code> function receives a <code>vec4</code> called <code>_c0</code> that represents the color being affected by the transform. As any function you may add any extra inputs. You must return another <code>vec4</code>.</p>
<div class="hydra-example">
    
    <div></div>
    <script>
        
       
       
    
        var preEl = document.currentScript.previousElementSibling
       
        
        
        var originalCode = "setFunction({\n    name: 'switchColors',\n    type: 'color',\n    inputs: [],\n    glsl: `\n        return _c0.brga;\n    `\n})\nosc(60,.1,5).switchColors()\n\t.out()"
        var codeApp = new CodeApp();
        preEl.insertAdjacentElement("afterend", codeApp.node);
        
        codeApp.cmApp.loaded(originalCode);
            
        preEl.style.display = "none";
    </script>
</div><h4 id="coord">
  coord
  <a class="anchor" href="#coord">#</a>
</h4>
<p>A <code>coord</code> function receives a <code>vec2</code> called <code>_st</code> that represents the coordinate plane. You must return another <code>vec2</code>.</p>
<div class="hydra-example">
    
    <div></div>
    <script>
        
       
       
    
        var preEl = document.currentScript.previousElementSibling
       
        
        
        var originalCode = "setFunction({\n    name: 'tan',\n    type: 'coord',\n    inputs: [\n      { name: 'freq', type: 'float', default: 1 },\n      { name: 'mult', type: 'float', default: 0.25 }\n    ],\n    glsl: `\n        return tan(_st*3.141592*freq)*mult;\n    `\n})\nosc(60,.1,5).tan(2)\n\t.out()"
        var codeApp = new CodeApp();
        preEl.insertAdjacentElement("afterend", codeApp.node);
        
        codeApp.cmApp.loaded(originalCode);
            
        preEl.style.display = "none";
    </script>
</div><h4 id="combine">
  combine
  <a class="anchor" href="#combine">#</a>
</h4>
<p>The functions of type <code>combine</code> receive 2 <code>vec4</code> arguments, <code>_c0</code> and <code>_c1</code>. The first one represents the texture being affected and the latter represents the texture being blended into the former. For example, when you use <code>osc().mult(noise())</code>, inside the definition of the function, <code>_c0</code> represents the <code>osc()</code> and <code>_c1</code> represents the <code>noise()</code> colors. You can think combine functions as blending modes. And as custom function you may add extra inputs as needed. You must return a <code>vec4</code>.</p>
<div class="hydra-example">
    
    <div></div>
    <script>
        
       
       
    
        var preEl = document.currentScript.previousElementSibling
       
        
        
        var originalCode = "setFunction({\n    name: 'negate',\n    type: 'combine',\n    inputs: [\n        { type: 'float', name: 'amount', default: 1 }\n    ],\n    glsl:`\n        _c1 *= amount;\n        return vec4(vec3(1.0)-abs(vec3(1.0)-_c0.rgb-_c1.rgb), min(max(_c0.a, _c1.a),1.0));\n    `\n})\nosc().negate(noise().brightness(.5))\n\t.out()"
        var codeApp = new CodeApp();
        preEl.insertAdjacentElement("afterend", codeApp.node);
        
        codeApp.cmApp.loaded(originalCode);
            
        preEl.style.display = "none";
    </script>
</div><h4 id="combinecoord">
  combineCoord
  <a class="anchor" href="#combinecoord">#</a>
</h4>
<p><code>combineCoord</code> functions change the position of colors in the texture being affected given the colors of another texture. Think about the many modulate functions for example, since they are precisely this type. They receive a <code>vec2 _st</code> and a <code>vec4 _c0</code>. You must return a <code>vec2</code>.</p>
<div class="hydra-example">
    
    <div></div>
    <script>
        
       
       
    
        var preEl = document.currentScript.previousElementSibling
       
        
        
        var originalCode = "setFunction({\n    name: 'myModulator',\n    type: 'combineCoord',\n    inputs: [],\n    glsl: `\n        return vec2(_st.x+(_c0.g-_c0.b*0.1),_st.y+(_c0.r*0.2));\n    `\n})\nnoise(2).myModulator(osc(20,.1,1).diff(o0))\n\t.out()"
        var codeApp = new CodeApp();
        preEl.insertAdjacentElement("afterend", codeApp.node);
        
        codeApp.cmApp.loaded(originalCode);
            
        preEl.style.display = "none";
    </script>
</div><h3 id="built-in-functions-you-can-use">
  Built in functions you can use
  <a class="anchor" href="#built-in-functions-you-can-use">#</a>
</h3>
<p>The following functions are pre-defined for every Hydra generated shader, and in the same way that some built-in functions use them, you may too:</p>
<h4 id="_luminance">
  _luminance
  <a class="anchor" href="#_luminance">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">float</span> _luminance(<span style="color:#66d9ef">vec3</span> rgb){
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">vec3</span> W <span style="color:#f92672">=</span> <span style="color:#66d9ef">vec3</span>(<span style="color:#ae81ff">0.2125</span>, <span style="color:#ae81ff">0.7154</span>, <span style="color:#ae81ff">0.0721</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> dot(rgb, W);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Returns the luminance of a given rgb color.</p>
<h4 id="_rgb2hsv">
  _rgb2Hsv
  <a class="anchor" href="#_rgb2hsv">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">vec3</span> _rgbToHsv(<span style="color:#66d9ef">vec3</span> c){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">vec4</span> K <span style="color:#f92672">=</span> <span style="color:#66d9ef">vec4</span>(<span style="color:#ae81ff">0.0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1.0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3.0</span>, <span style="color:#ae81ff">2.0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3.0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1.0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">vec4</span> p <span style="color:#f92672">=</span> mix(<span style="color:#66d9ef">vec4</span>(c.bg, K.wz), <span style="color:#66d9ef">vec4</span>(c.gb, K.xy), step(c.b, c.g));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">vec4</span> q <span style="color:#f92672">=</span> mix(<span style="color:#66d9ef">vec4</span>(p.xyw, c.r), <span style="color:#66d9ef">vec4</span>(c.r, p.yzx), step(p.x, c.r));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> d <span style="color:#f92672">=</span> q.x <span style="color:#f92672">-</span> min(q.w, q.y);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> e <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0e-10</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">vec3</span>(abs(q.z <span style="color:#f92672">+</span> (q.w <span style="color:#f92672">-</span> q.y) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">6.0</span> <span style="color:#f92672">*</span> d <span style="color:#f92672">+</span> e)), d <span style="color:#f92672">/</span> (q.x <span style="color:#f92672">+</span> e), q.x);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Transforms a color from the rgb to the hsv colorspace.</p>
<h4 id="_hsv2rgb">
  _hsv2Rgb
  <a class="anchor" href="#_hsv2rgb">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-glsl" data-lang="glsl"><span style="display:flex;"><span><span style="color:#66d9ef">vec3</span> _hsvToRgb(<span style="color:#66d9ef">vec3</span> c){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">vec4</span> K <span style="color:#f92672">=</span> <span style="color:#66d9ef">vec4</span>(<span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">2.0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3.0</span>, <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">3.0</span>, <span style="color:#ae81ff">3.0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">vec3</span> p <span style="color:#f92672">=</span> abs(fract(c.xxx <span style="color:#f92672">+</span> K.xyz) <span style="color:#f92672">*</span> <span style="color:#ae81ff">6.0</span> <span style="color:#f92672">-</span> K.www);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> c.z <span style="color:#f92672">*</span> mix(K.xxx, clamp(p <span style="color:#f92672">-</span> K.xxx, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.0</span>), c.y);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Transforms a color from the hsv colorspace back to rgb.</p>
<h5 id="note">
  Note
  <a class="anchor" href="#note">#</a>
</h5>
<p>As of now there is no way to define &ldquo;global&rdquo; functions such as these ones just mentioned. But expect it soon!</p>
<h3 id="examples">
  Examples
  <a class="anchor" href="#examples">#</a>
</h3>
<h4 id="chroma-key">
  Chroma Key
  <a class="anchor" href="#chroma-key">#</a>
</h4>
<p>This example modifies <code>color</code> to replace green background with transparency (i.e., chroma keying). The GLSL code is ported from <a href="https://www.shadertoy.com/view/XsfGzn">Inigo Quilez&rsquo;s example</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">setFunction</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;chroma&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;color&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">inputs</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">glsl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        float maxrb = max( _c0.r, _c0.b );
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        float k = clamp( (_c0.g-maxrb)*5.0, 0.0, 1.0 );
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        float dg = _c0.g; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        _c0.g = min( _c0.g, maxrb*0.8 ); 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        _c0 += vec4(dg - _c0.g);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        return vec4(_c0.rgb, 1.0 - k);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// s0.initCam()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// src(s0).out(o0)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">solid</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>).<span style="color:#a6e22e">layer</span>(<span style="color:#a6e22e">shape</span>(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">0.3</span>,<span style="color:#ae81ff">0.3</span>).<span style="color:#a6e22e">luma</span>()).<span style="color:#a6e22e">out</span>(<span style="color:#a6e22e">o0</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">osc</span>(<span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>).<span style="color:#a6e22e">layer</span>(<span style="color:#a6e22e">src</span>(<span style="color:#a6e22e">o0</span>).<span style="color:#a6e22e">chroma</span>()).<span style="color:#a6e22e">out</span>(<span style="color:#a6e22e">o1</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">render</span>()
</span></span></code></pre></div><hr>
<h2 id="glsl-injection">
  GLSL Injection
  <a class="anchor" href="#glsl-injection">#</a>
</h2>
<p>Since Hydra runs GLSL on the background, and everything you input into the parameters of the different functions ends up written on GLSL (be it literally or as a uniform), you can sort of hack Hydra (and totally break it) by sending strings of GLSL expressions as arguments:</p>
<div class="hydra-example">
    
    <div></div>
    <script>
        
       
       
    
        var preEl = document.currentScript.previousElementSibling
       
        
        
        var originalCode = "src(o0)\n    .scroll(()=\u003emouse.x/innerWidth,()=\u003emouse.y/innerHeight)\n    .layer(noise(3).sub(osc(5,.1,2)).luma(.1,.01))\n    .scroll(\"-sign(st.x-0.5)*0.5\",\"-sign(st.y-0.5)*0.2\")\n    .scale(\"0.8+st.x*0.2\")\n    .rotate(0,.1)\n\t.brightness(.01)\n    .out()"
        var codeApp = new CodeApp();
        preEl.insertAdjacentElement("afterend", codeApp.node);
        
        codeApp.cmApp.loaded(originalCode);
            
        preEl.style.display = "none";
    </script>
</div><p>The reason you can &ldquo;totally break Hydra&rdquo; here is that Hydra works with a modular flow. In order for it to work, when you do coordinate transforms after a bunch of interconnected textures, these transforms must apply to all coordinate references in the shader. If you inject values of the <code>st</code> coordinates in your arguments, Hydra has no way of applying any further transforms to them, therefore breaking the modularity.</p>
<hr>
<h2 id="extensions">
  Extensions
  <a class="anchor" href="#extensions">#</a>
</h2>
<h3 id="extra-shaders">
  Extra shaders
  <a class="anchor" href="#extra-shaders">#</a>
</h3>
<p>There are some Hydra extensions that load many custom glsl functions, such as:</p>
<ul>
<li><a href="https://gitlab.com/metagrowing/extra-shaders-for-hydra">extra-shaders-for-hydra</a></li>
<li><a href="https://github.com/ritchse/hydra-extensions">hydra-blending-modes</a></li>
</ul>
<h3 id="extra-functionality">
  Extra Functionality
  <a class="anchor" href="#extra-functionality">#</a>
</h3>
<p>The <a href="https://github.com/ritchse/hydra-extensions/blob/main/doc/hydra-glsl.md">hydra-glsl extension</a> allows you to write GLSL directly in your patches. For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">glsl</span>(<span style="color:#e6db74">&#39;vec4(sin(((_st.x*54.)+time*2.)*vec3(0.1,0.102,0.101)),1.0)&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">diff</span>(<span style="color:#a6e22e">o0</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">glslColor</span>(<span style="color:#e6db74">&#39;vec4(c0.brg,1.)&#39;</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">glslCoord</span>(<span style="color:#e6db74">&#39;xy*=(1.0/vec2(i0, i0)); return xy&#39;</span>,.<span style="color:#ae81ff">25</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">glslCombine</span>(<span style="color:#e6db74">&#39;c0-c1&#39;</span>,<span style="color:#a6e22e">o1</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">glslCombineCoord</span>(<span style="color:#e6db74">&#39;uv+(vec2(c0.r,c0.b)*0.1)&#39;</span>,<span style="color:#a6e22e">o1</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">out</span>()
</span></span></code></pre></div><hr>
<p>by geikha</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/hydra-synth/hydra-docs-v2/commit/1dd27b0a5f5ca9dcec9e0cccc27657c0a09cf72d" title='Last modified by ojack | November 20, 2023' target="_blank" rel="noopener">
      <img src="/docs/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>November 20, 2023</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/hydra-synth/hydra-docs-v2/edit/main/content/docs/learning/extending-hydra/glsl.md" target="_blank" rel="noopener">
      <img src="/docs/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#using-custom-glsl-functions">Using custom GLSL functions</a>
      <ul>
        <li><a href="#setfunction">setFunction</a></li>
        <li><a href="#types-of-glsl-functions-and-their-arguments">Types of GLSL functions and their arguments</a></li>
        <li><a href="#built-in-functions-you-can-use">Built in functions you can use</a></li>
        <li><a href="#examples">Examples</a></li>
      </ul>
    </li>
    <li><a href="#glsl-injection">GLSL Injection</a></li>
    <li><a href="#extensions">Extensions</a>
      <ul>
        <li><a href="#extra-shaders">Extra shaders</a></li>
        <li><a href="#extra-functionality">Extra Functionality</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












